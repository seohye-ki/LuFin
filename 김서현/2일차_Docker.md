# [2025-03-05] Docker

## 🎯 학습 목표

- 도커의 개념과 등장 배경 이해
- 도커의 핵심 요소(이미지, 컨테이너, Dockerfile 등) 학습
- 도커 설치
- 도커 컨테이너 실행 실습
- 도커 컴포즈 학습

## 📌 도커 공부하기

### 🔹 **도커란 무엇인가?**
- 도커는 **어디서든 동일한 환경**에서 애플리케이션을 실행할 수 있도록 도와주는 **컨테이너 기반 가상화 기술**이다.
- 기존의 가상 머신(VM)보다 가볍고 빠르며, 실행에 필요한 모든 요소(코드, 라이브러리, 설정)를 포함한 **이미지(Image)** 기반으로 동작한다.

### 🔹 **도커가 해결한 문제**
- 개발 환경(OS, 라이브러리 버전 등)이 다르면 실행 오류 발생 → 도커로 해결 가능
- 기존의 가상 머신은 무겁고 리소스를 많이 사용 → 도커 컨테이너는 가벼움
- 배포할 때 실행 환경이 다르면 문제가 생김 → 도커로 어디서든 동일한 실행 환경 제공

### 🔹 **도커에서 다루는 주요 개념**
| 개념 | 설명 |
|------|------|
| **이미지(Image)** | 컨테이너를 만들기 위한 템플릿(설정, 코드, 라이브러리 포함) |
| **컨테이너(Container)** | 이미지를 실행한 환경(실제 동작하는 앱) |
| **Dockerfile** | 이미지를 만들기 위한 설정 파일 |
| **Docker Hub** | 도커 이미지를 공유하는 공식 저장소 |
| **볼륨(Volume)** | 컨테이너와 호스트(OS) 간 데이터 공유 |


### 🔹 **도커 컴포즈(Docker Compose) 사용하기**
- Docker Compose란? 여러 개의 컨테이너를 한 번에 실행하고 관리할 수 있도록 도와주는 도구. docker-compose.yml 파일 하나로 여러 서비스를 정의할 수 있음.

### 🔹 **도커 컴포즈(Docker Compose) 사용하기**
- Docker Compose는 YAML 파일(docker-compose.yml)을 사용해서 여러 개의 컨테이너를 정의한다.
```yaml
version: '3'  # 사용할 Compose 버전

services:  # 실행할 컨테이너 목록
  서비스명1:
    image: 사용할_이미지
    container_name: 컨테이너이름
    ports:
      - "호스트포트:컨테이너포트"
    volumes:
      - "호스트경로:컨테이너경로"
    environment:
      - "환경변수명=값"
    depends_on:
      - "다른_서비스"
```

### 🔹 **컨테이너 실행 후 종료하면 어떻게 될까?**
| 상태 | 설명 |
|------|------|
| `docker run` 실행 | 새 컨테이너가 생성되어 실행됨 |
| 컨테이너 종료 (`docker stop`) | 컨테이너가 멈추지만, 삭제되지는 않음 |
| `docker start` | 기존 컨테이너를 다시 실행 |
| `docker restart` | 컨테이너를 다시 시작 |
| `docker rm` | 컨테이너 완전 삭제 (데이터도 사라짐) |


### 🔹 **도커 사용 시 주의할 점**
### **1. 컨테이너 삭제 시 데이터 손실 위험**
- 컨테이너 자체는 휘발성이기 때문에 **컨테이너를 삭제하면 내부 데이터도 사라짐**.
- 데이터가 유지되길 원하면 **볼륨(Volume)을 사용**해야 함.

✅ **해결 방법: 볼륨 사용**
```sh
docker run -d --name my-db -v my-volume:/var/lib/mysql mysql
```
이렇게 하면 컨테이너가 삭제되어도 `my-volume`에 데이터가 남아 있음.

### **2. 포트 충돌 문제**
- 같은 포트를 여러 컨테이너가 사용하면 충돌이 발생함.
- 예를 들어, 8080 포트에서 두 개의 컨테이너를 실행하려 하면 충돌함.

✅ **해결 방법: 포트 변경**
```sh
docker run -d -p 8081:80 nginx
docker run -d -p 8082:80 nginx
```
이렇게 하면 각각 8081, 8082 포트로 접근 가능.

### **3. 컨테이너는 독립적이지만 네트워크를 설정해야 통신 가능**
- 기본적으로 컨테이너는 서로 다른 네트워크에 있음.
- 컨테이너 간 통신이 필요하면 **같은 네트워크에 연결해야 함**.

✅ **해결 방법: 네트워크 생성 후 컨테이너 연결**
```sh
docker network create my-network
docker run -d --name web --network my-network nginx
docker run -d --name db --network my-network mysql
```
이제 `web` 컨테이너와 `db` 컨테이너가 서로 통신 가능!

### **4. 불필요한 컨테이너, 이미지 쌓이면 디스크 용량 낭비**
- 실행했던 컨테이너와 이미지가 삭제되지 않으면 디스크 용량을 차지함.

✅ **해결 방법: 사용하지 않는 컨테이너/이미지 정리**
```sh
docker system prune -a  # 모든 중지된 컨테이너, 안 쓰는 이미지 삭제
```

## 🔗 참고자료

- [Hudi Blog - Docker 기초](https://hudi.blog/about-docker/)
