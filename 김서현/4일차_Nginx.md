# [2025-03-07] Nginx

## π― ν•™μµ λ©ν‘

- Nginxμ κΈ°λ³Έ κ°λ…κ³Ό μ—­ν• μ„ μ΄ν•΄ν•κΈ°
- Nginxλ¥Ό μ‚¬μ©ν•λ©΄ μ¤νλ ¤ μ„±λ¥μ΄ ν–¥μƒλλ” μ΄μ λ¥Ό μ΄ν•΄ν•κΈ°
- λ¦¬λ²„μ¤ ν”„λ΅μ‹(Reverse Proxy)μ κ°λ…κ³Ό ν•„μ”μ„±
- CORS(Cross-Origin Resource Sharing) μ—λ¬μ μ›μΈκ³Ό ν•΄κ²° λ°©λ²•

## π“ Nginx
λ¦¬λ²„μ¤ ν”„λ΅μ‹λ” ν΄λΌμ΄μ–ΈνΈ(λΈλΌμ°μ €)μ™€ μ„λ²„(API μ„λ²„) μ‚¬μ΄μ—μ„ μ”μ²­μ„ μ¤‘κ³„ν•λ” μ„λ²„μ•Ό. μ¦‰, ν΄λΌμ΄μ–ΈνΈλ” μ‹¤μ  λ°±μ—”λ“ μ„λ²„κ°€ μ•„λ‹λΌ λ¦¬λ²„μ¤ ν”„λ΅μ‹(Nginx κ°™μ€ μ„λ²„)μ— μ”μ²­μ„ λ³΄λ‚΄κ³ , μ΄ ν”„λ΅μ‹κ°€ λ°±μ—”λ“ μ„λ²„μ— μ „λ‹¬ν• λ‹¤μ, μ‘λ‹µμ„ λ°›μ•„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ‹¤μ‹ λ³΄λ‚΄μ£Όλ” μ—­ν• μ„ ν•¨.


### π”Ή **Nginxμ μ—­ν• **

- μ›Ή μ„λ²„(Web Server): μ •μ  νμΌ(HTML, CSS, JS, μ΄λ―Έμ§€ λ“±) μ„λΉ™
- λ¦¬λ²„μ¤ ν”„λ΅μ‹(Reverse Proxy): λ°±μ—”λ“ μ„λ²„(API)μ™€ ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄μ—μ„ μ”μ²­μ„ μ¤‘κ³„
- λ΅λ“ λ°Έλ°μ„(Load Balancer): μ—¬λ¬ κ°μ μ„λ²„μ— νΈλν”½μ„ λ¶„μ‚°ν•μ—¬ λ¶€ν•λ¥Ό μ¤„μ„
- SSL/TLS(HTTPS) μ§€μ›: λ³΄μ• κ°•ν™”λ¥Ό μ„ν•΄ HTTPS μ„¤μ • κ°€λ¥
- μΊμ‹±(Caching): μμ£Ό μ”μ²­λλ” λ¦¬μ†μ¤λ¥Ό μ €μ¥ν•μ—¬ μ„±λ¥ μµμ ν™”

λ°°ν¬ν•  ν”„λ΅μ νΈμ—μ„, λ°±μ—”λ“ μ„λ²„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ™€ μ§μ ‘ μ—°κ²°ν•λ” λ€μ‹ , Nginxλ¥Ό μ•μ— λ‘κ³  νΈλν”½μ„ κ΄€λ¦¬ν•λ©΄ ν›¨μ”¬ ν¨μ¨μ 

### π”Ή **Nginxλ¥Ό λ‘λ”κ² μ™ λΉ λ¥ΌκΉ?**
μ¤‘κ°„μ— Nginxλ¥Ό ν•λ‚ λ” λ‘λ©΄ μ”μ²­μ΄ λλ ¤μ§ κ²ƒ κ°™μ§€λ§, μ‹¤μ λ΅λ” λ” λΉ λ¥΄κ² λ™μ‘. μ™??
1) μ •μ  νμΌ μΊμ‹±
- Nginxκ°€ HTML, CSS, JS, μ΄λ―Έμ§€ κ°™μ€ μ •μ  νμΌμ„ μΊμ‹±ν•λ©΄, λ°±μ—”λ“κΉμ§€ μ”μ²­μ΄ κ°€μ§€ μ•κ³  λ°”λ΅ μ‘λ‹µ κ°€λ¥!
- κ²°κ³Ό: λ°±μ—”λ“ λ¶€ν• κ°μ† + λΉ λ¥Έ μ‘λ‹µ
2) λ¦¬λ²„μ¤ ν”„λ΅μ‹λ¥Ό ν†µν• λ¶€ν• λ¶„μ‚°
- λ°±μ—”λ“κ°€ μ§μ ‘ λ¨λ“  μ”μ²­μ„ λ°›μΌλ©΄ λ¶€λ‹΄μ΄ ν¬μ§€λ§, Nginxκ°€ μ”μ²­μ„ ν•„ν„°λ§ν•΄μ„ λ°±μ—”λ“μ— ν•„μ”ν• μ”μ²­λ§ λ³΄λ‚΄μ¤.
- κ²°κ³Ό: λ°±μ—”λ“ μ„λ²„κ°€ λ” κ°€λ²Όμ›μ§.
3) Keep-Alive μ—°κ²° μ μ§€
- Nginxκ°€ λ°±μ—”λ“ μ„λ²„μ™€ Keep-Alive μ—°κ²°μ„ μ μ§€ν•λ©΄, λ§¤λ² μƒ μ—°κ²°μ„ λ§λ“¤μ§€ μ•μ•„λ„ λ¨.
- κ²°κ³Ό: μ”μ²­ μ†λ„ μ¦κ°€
4) μ••μ¶•(Gzip, Brotli)μΌλ΅ μ „μ†΅ μµμ ν™”
- Nginxλ” λ°μ΄ν„°λ¥Ό μ••μ¶•ν•΄μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ³΄λ‚΄λ―€λ΅, λ„¤νΈμ›ν¬ νΈλν”½μ΄ κ°μ†ν•¨.
- κ²°κ³Ό: μ „μ†΅ μ†λ„κ°€ λΉ¨λΌμ§.

## π“ λ¦¬λ²„μ¤ ν”„λ΅μ‹(Reverse Proxy)λ€?

### π”Ή **λ¦¬λ²„μ¤ ν”„λ΅μ‹μ μ—­ν• **

μ§μ ‘ λ°±μ—”λ“ μ„λ²„μ— μ”μ²­ν•λ©΄ λ  ν…λ°, κµ³μ΄ μ¤‘κ°„μ— ν•λ‚λ¥Ό λ” λ‘λ” μ΄μ λ” λ­κΉ?

1. λ³΄μ• κ°•ν™” (Security)
- ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ λ°±μ—”λ“ μ„λ²„(μ: http://my-api-server:5000)μ— μ ‘κ·Όν•λ©΄ λ³΄μ•μƒ μ„ν—ν•  μ μμ–΄, λ¦¬λ²„μ¤ ν”„λ΅μ‹λ¥Ό λ‘λ©΄, μ‹¤μ  λ°±μ—”λ“ μ„λ²„μ IPλ¥Ό κ°μ¶ μ μμ–΄μ„ λ³΄μ•μ΄ κ°•ν™”λκ³ , DDoS κ³µκ²©μ„ λ°©μ–΄ν•λ” WAF(Web Application Firewall) μ—­ν• λ„ ν•  μ μλ‹¤.
2. SSL(HTTPS) μ μ©
- λ°±μ—”λ“ μ„λ²„λ” μ›λ HTTPλ΅λ§ λ™μ‘ν•  μλ„ μλ”λ°, Nginx λ¦¬λ²„μ¤ ν”„λ΅μ‹λ¥Ό ν†µν•΄ SSL(HTTPS)λ¥Ό μ μ©ν•λ©΄ λ³΄μ•μ΄ κ°•ν™”λκ³ ,
μ¦‰, ν΄λΌμ΄μ–ΈνΈλ” https://example.comμΌλ΅ μ”μ²­ν•μ§€λ§, λ‚΄λ¶€μ μΌλ΅λ” http://backend:5000μ— μ”μ²­μ΄ κ° μλ„ μκ²λλ‹¤.
3. λ΅λ“ λ°Έλ°μ‹± (Load Balancing)
- λ°±μ—”λ“ μ„λ²„κ°€ μ—¬λ¬ κ°μΌ λ•, λ¦¬λ²„μ¤ ν”„λ΅μ‹κ°€ λ¶€ν•λ¥Ό λ¶„μ‚°ν•΄μ„ μ„λ²„κ°€ ν•μ½μΌλ΅ λ°λ¦¬λ” κ±Έ λ°©μ§€ν•  μ μλ‹¤. μλ¥Ό λ“¤μ–΄, μ„λ²„κ°€ 3κ°(server1, server2, server3) μμΌλ©΄, Nginxκ°€ μ”μ²­μ„ κ°κ° λ‚λ μ„ μ „λ‹¬ν•  μ μλ‹¤.
4. μΊμ‹± (Caching)
- μ •μ μΈ λ°μ΄ν„°(API μ‘λ‹µ, μ΄λ―Έμ§€, HTML νμΌ λ“±)λ¥Ό Nginxκ°€ μΊμ‹±ν•λ©΄, λ°±μ—”λ“ μ„λ²„ λ¶€ν•λ¥Ό μ¤„μ΄κ³  μ„±λ¥μ„ ν–¥μƒμ‹ν‚¬ μ μλ‹¤.
μμ£Ό μ”μ²­λλ” λ°μ΄ν„°λ¥Ό λ§¤λ² λ°±μ—”λ“μ—μ„ κ°€μ Έμ¤μ§€ μ•κ³  Nginxκ°€ μ €μ¥ν•΄λ‘κ³  λ°ν™ν•λ©΄ μ†λ„κ°€ λΉ¨λΌμ§„λ‹¤.
5. λ„λ©”μΈ λ° κ²½λ΅ λ§¤ν•‘
- μλ¥Ό λ“¤μ–΄, ν”„λ΅ νΈμ—”λ“μ™€ λ°±μ—”λ“κ°€ λ‹¤λ¥Έ ν¬νΈμ—μ„ λ™μ‘ν•λ”λ°, ν΄λΌμ΄μ–ΈνΈλ” ν•λ‚μ λ„λ©”μΈ(example.com)λ§ μ•λ„λ΅ λ§λ“¤κ³  μ‹¶λ‹¤λ©΄?
λ¦¬λ²„μ¤ ν”„λ΅μ‹λ¥Ό μ‚¬μ©ν•λ©΄ ν”„λ΅ νΈμ—”λ“(/)μ™€ λ°±μ—”λ“ API(/api/)λ¥Ό κ°™μ€ λ„λ©”μΈμ—μ„ μ κ³µν•  μ μκ³ , μ΄λ ‡κ² ν•λ©΄ CORS λ¬Έμ λ„ μ¤„μΌ μ μμ.


#### μ„¤μ •μμ‹
```nginx
# https://example.com/api/ μ”μ²­μ΄ http://backend-server:8080/ μΌλ΅ μ „λ‹¬
server {
    listen 80;
    server_name example.com;

    location /api/ {
        proxy_pass http://backend-server:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```


## π“ CORS(Cross-Origin Resource Sharing)λ€?

### π”Ή **CORSκ°€ λ°μƒν•λ” μ΄μ **
- λΈλΌμ°μ € λ³΄μ• μ •μ±…(Same-Origin Policy) λ•λ¬Έμ—, λ‹¤λ¥Έ μ¶μ²(Origin)μ—μ„ API μ”μ²­μ„ λ§‰μ
- μ¶μ²(Origin) = `ν”„λ΅ν† μ½ + λ„λ©”μΈ + ν¬νΈ`
- λ‹¤λ¥Έ μ¶μ²μ—μ„ μ”μ²­ν•λ©΄ CORS μ—λ¬ λ°μƒ

  | μ”μ²­ | κ°™μ€ μ¶μ²? | CORS ν•„μ”? |
  |---|---|---|
  | `http://example.com` β†’ `http://example.com` | β… O | β ν•„μ” μ—†μ |
  | `http://example.com:3000` β†’ `http://example.com:5000` | β X | β… ν•„μ” |
  | `https://example.com` β†’ `http://example.com` | β X | β… ν•„μ” |
  | `http://localhost:3000` β†’ `http://localhost:5000` | β X | β… ν•„μ” |