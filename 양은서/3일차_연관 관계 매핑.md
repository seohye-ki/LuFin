# [2025-03-06] 3ì¼ì°¨_ì—°ê´€ ê´€ê³„ ë§¤í•‘ (1:N, N:1, M:N)

## ğŸ¯ í•™ìŠµ ëª©í‘œ
- ì—°ê´€ ê´€ê³„ ì´í•´
- í…Œì´ë¸” ê°„ì˜ ê´€ê³„ë¥¼ ë§¤í•‘í•˜ëŠ” ë°©ë²• ìŠµë“

## ğŸ“Œ ì—°ê´€ ê´€ê³„ ë§¤í•‘ì´ì´ë€?
- JPAì—ì„œëŠ” ê°ì²´ì˜ í•„ë“œì™€ ë°ì´í„° ë² ì´ìŠ¤ì˜ ê´€ê³„ë¥¼ ë§¤í•‘í•  ìˆ˜ ìˆìŒ
    - ê¸°ì¡´ JDBC, MyBatis ë°©ì‹: ì™¸ë˜ í‚¤(FK)ë¥¼ ì§ì ‘ ê´€ë¦¬
    - JPA ë°©ì‹: ê°ì²´ ê´€ê³„ë¥¼ í™œìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ë§¤í•‘

### ğŸ”¹ ê¸°ì¡´ SQL ë°©ì‹ (ì™¸ë˜ í‚¤ ì§ì ‘ ê´€ë¦¬)
```sql
INSERT INTO team (id, name) VALUES (1, 'Team A');
INSERT INTO member(id, name, team_id) VALUES (1, 'Alice', 1);
```

### ğŸ”¹ JPA ë°©ì‹ (ê°ì²´ ì—°ê´€ ê´€ê³„ í™œìš©)
```java
Team team = new Team("Team A");
teamRepository.save(team);

Member member = new Member("Alice", team);
memberRepository.save(member);
```
### ğŸ”¹ JPA ë°©ì‹ì˜ ì¥ì 
- SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ê°ì²´ë§Œ ë‹¤ë£¨ë©´ ë¨
- ì™¸ë˜ í‚¤ë¥¼ ì§ì ‘ ê´€ë¦¬í•  í•„ìš” ì—†ì´, JPAê°€ ìë™ìœ¼ë¡œ SQLì„ ìƒì„±

## ğŸ“Œ ì—°ê´€ ê´€ê³„ ë§¤í•‘(1:N, N:1, M:N)
| ê´€ê³„ ìœ í˜• | ì„¤ëª… | ì˜ˆì œ |
|:----:|:---:|:---:|
| 1:N | í•˜ë‚˜ì˜ ë¶€ëª¨ê°€ ì—¬ëŸ¬ ìì‹ì„ ê°€ì§ | íŒ€ â†” ë©¤ë²„ |
| N:1 | ì—¬ëŸ¬ ê°œì˜ ìì‹ì´ í•˜ë‚˜ì˜ ë¶€ëª¨ë¥¼ ê°€ì§ | ë©¤ë²„ â†” íŒ€ |
| M:N | ë‹¤ëŒ€ë‹¤ ê´€ê³„ (ì—°ê²° í…Œì´ë¸” í•„ìš”) | í•™ìƒ â†” ê°•ì˜ |

## ğŸ“Œ 1:N ê´€ê³„
- í•œ ê°œì˜ íŒ€ì´ ì—¬ëŸ¬ ëª…ì˜ ë©¤ë²„ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ
- `@OneToMany`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ê³„ ì„¤ì •ì •

### ğŸ”¹ `@Team` ì—”í‹°í‹°

```java
import jakarta.persistence.*;
import lombok.Getter;
import lombok.NoArgsConstructor;
import java.util.ArrayList;
import java.util.List;

@Getter
@NoArgsConstructor
@Entity
public class Team {
    
    @Id
    @GeneratedValue(strategy = GenerateionType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;
    
    @OneToMany(mappedBy = "team", cascade = CascadeType.ALL) // 1:N ê´€ê³„
    private List<Member> members = new ArrayList<>();

    public Team(String name){
        this.name = name;
    }
}

```

### ğŸ”¹ `@Member` ì—”í‹°í‹°

```java
import jakarta.persistence.*;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@NoArgsConstructor
@Entity
public class Member {
    
    @Id
    @GeneratedValue(strategy = GenerateionType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;
    
    @ManyToOne // N:1 ê´€ê³„
    @JoinColumn(name = "team_id") // ì™¸ë˜í‚¤ ì„¤ì •ì •
    private Team team;

    public Member(String name, Team team) {
        this.name = name;
        this.team = team;
    }
}

```
- `@OneToMany(mappedBy="team")`
    - **mappedBy**ëŠ” `Member` ì—”í‹°í‹°ì˜ `team` í•„ë“œì— ì˜í•´ ë§¤í•‘ë¨ì„ ì˜ë¯¸ í•¨
    - `cascade = CascadeType.ALL` â†’ ë¶€ëª¨(`Team`)ê°€ ì‚­ì œë˜ë©´ ìì‹(`Member`)ë„ ì‚­ì œ ë¨
- `@ManyToOne` & `@JoinColumn(name = "team_id")`
    - `@JoinColumn`ì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë˜ í‚¤ë¥¼ ì§ì ‘ ì„¤ì • í•  ìˆ˜ ìˆìŒ


## ğŸ“Œ N:1 ê´€ê³„
- 1:N ê´€ê³„ì™€ ë™ì¼
- `@ManyToOne`ë§Œ ì‚¬ìš©í•´ë„ N:1 ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆìŒ
- Nìª½ì´ ë¶€ëª¨ì˜ ì •ë³´ë¥¼ ê°€ì§ â†’ ì™¸ë˜ í‚¤ê°€ `Member` í…Œì´ë¸”ì— ì¡´ì¬

## ğŸ“Œ M:N ê´€ê³„
- ex) í•˜ë‚˜ì˜ í•™ìƒì´ ì—¬ëŸ¬ ê°•ì˜ë¥¼ ìˆ˜ê°•í•  ìˆ˜ ìˆìŒ
- í•˜ë‚˜ì˜ ê°•ì˜ë„ ì—¬ëŸ¬ í•™ìƒì´ ë“¤ì„ ìˆ˜ ìˆìŒ
- í•™ìƒ â†” ê°•ì˜: ë‹¤ëŒ€ë‹¤ ê´€ê³„

### ğŸ”¹ ê¸°ë³¸ì ì¸ ManyToMany ë§¤í•‘
```java
@Entity
public class Student {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;

    @ManyToMany
    @JoinTable(name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id"))
    private List<Course> courses = new ArrayList<>();

}

```

```java
@Entity
public class Course {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Coulmn(nullable = false)
    private String title;

    @ManyToMany(mappedBy = "courses") // ManyToMany ì—­ë°©í–¥ ì„¤ì •
    private List<Student> student = new ArrayList<>();
}

```
- ì—°ê²° í…Œì´ë¸” (`student_course`)ì„ ìë™ìœ¼ë¡œ ìƒì„±
- `@JoinTable`ì„ ì‚¬ìš©í•˜ì—¬ ì¤‘ê°„ í…Œì´ë¸”ì„ ì§ì ‘ ì§€ì • ê°€ëŠ¥
- ê·¸ëŸ¬ë‚˜ ManyToMany ê´€ê³„ ë³´ë‹¤ ì¤‘ê°„ í…Œì´ë¸”ì„ ë”°ë¡œ ì—”í‹°í‹°ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë”ìš± ìœ ì—°í•¨
- ManyToManyë¥¼ ì‚¬ìš©í•˜ë©´ ì´í›„ ì»¬ëŸ¼ ì¶”ê°€ê°€ ì–´ë ¤ì›€
- 1:N, N:1 ê´€ê³„ë¡œ í’€ì–´ì„œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì 


## ğŸ”— ì°¸ê³ ìë£Œ

- [Spring Data JPA ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [Spring Boot ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [Hibernate ê³µì‹ ë¬¸ì„œ](https://hibernate.org/orm/documentation/6.6/)
- [Spring Boot + JPA ê°€ì´ë“œ](https://spring.io/guides/gs/accessing-data-jpa/)
